# Product Requirements Document: Clara Provider iOS App

**Version:** 1.0  
**Date:** November 2, 2025  
**Status:** MVP Complete

---

## 1. Executive Summary

### 1.1 Product Vision
Clara Provider is an iOS application that enables healthcare providers to efficiently review, respond to, and manage patient triage requests generated by the Clara AI health assistant platform. The app serves as the provider-facing counterpart to the patient-facing Clara iOS app, facilitating real-time clinical decision support and patient communication.

### 1.2 Problem Statement
Healthcare providers need a fast, intuitive way to:
- Review AI-generated triage recommendations for patient cases
- Provide clinical feedback and override recommendations when necessary
- Access patient medical history and conversation context
- Manage multiple review requests efficiently
- Respond to patients in a timely manner

### 1.3 Solution Overview
A native iOS app that provides:
- Real-time review request management with intelligent filtering
- Complete conversation context with AI recommendations
- Quick response workflows for common scenarios
- Patient profile access with medical history
- Push notifications for urgent cases

---

## 2. Product Goals & Objectives

### 2.1 Primary Goals
1. **Reduce Response Time**: Enable providers to review and respond to cases within 10 minutes
2. **Improve Clinical Decision Quality**: Provide comprehensive context for informed decisions
3. **Increase Provider Efficiency**: Streamline review workflows with smart filtering and quick actions
4. **Enhance Patient Safety**: Flag urgent cases and ensure timely provider review

### 2.2 Success Metrics
- **Average Response Time**: < 10 minutes from request to provider response
- **Review Completion Rate**: > 95% of requests reviewed within 24 hours
- **Provider Satisfaction**: > 4.5/5 rating on ease of use
- **Urgent Case Response**: < 5 minutes for escalated cases
- **App Uptime**: > 99.9% availability

---

## 3. Target Users

### 3.1 Primary User Personas

**Busy Primary Care Physician**
- Reviews 20-30 cases per day
- Needs quick access to patient history
- Values time-saving features
- Uses iPhone during clinic hours

**Telemedicine Provider**
- Reviews cases remotely
- Requires detailed conversation context
- Needs to respond quickly to maintain patient trust
- Relies on push notifications for urgent cases

### 3.2 User Characteristics
- Healthcare providers (MD, DO, NP, PA)
- Age range: 30-65
- Tech-savvy but time-constrained
- Need mobile-first solution
- Require HIPAA-compliant platform

---

## 4. Core Features

### 4.1 Review Request Management ✅

**Feature Description**: Central hub for viewing and managing all patient review requests.

**Key Capabilities**:
- **List View**: Scrollable list of all review requests with key information
- **Status Filtering**: Filter by Pending, All, or Flagged status
- **Search**: Full-text search by conversation title or patient name
- **Pull-to-Refresh**: Manual refresh of review list
- **Auto-Refresh**: Automatic updates every 60 seconds

**UI Components**:
- `ConversationListView`: Main list interface
- `StatusFilterButton`: Filter controls (Pending/All/Flagged)
- `ConversationRowView`: Individual request row
- `StatusBadge`: Visual status indicators
- `TriageBadge`: Triage outcome display

**Data Displayed**:
- Conversation title
- Patient name and age
- Status badge (pending/escalated/flagged/responded)
- Triage outcome (ER/Urgent/Routine/Home Care)
- Timestamp (relative format: "2 hours ago")
- Message preview (if title missing)

**User Flow**:
1. Provider opens app → Sees list of review requests
2. Filters by "Pending" → Sees only pending cases
3. Searches for patient name → Finds specific case
4. Taps conversation → Opens detail view

---

### 4.2 Conversation Detail View ✅

**Feature Description**: Comprehensive view of a single patient conversation with AI recommendations and response tools.

**Key Capabilities**:
- **Full Conversation Thread**: Complete message history between patient and Clara AI
- **Patient Information Card**: Demographics, age, medical context
- **AI Summary Display**: Plaintext summary of the conversation
- **Provider Reply Box**: Quick response interface with dropdown and text input
- **Review Result Display**: Shows completed review status and provider response
- **Dismiss Option**: Ability to dismiss review without responding

**UI Components**:
- `ConversationDetailView`: Main detail interface
- `PatientInfoCard`: Patient demographics display
- `ProviderReplyBox`: Response input interface
- `ReviewResultView`: Completed review display
- `MessageBubbleView`: Individual message bubbles
- `ClaraMarkdownView`: Formatted AI responses

**Response Types**:
1. **Agree**: Provider agrees with AI recommendation
2. **Agree with Thoughts**: Agrees but adds additional context
3. **Disagree with Thoughts**: Disagrees and provides alternative recommendation
4. **Escalation Needed**: Requires higher-level review
5. **Dismiss**: Dismisses review without responding

**User Flow**:
1. Provider taps conversation → Opens detail view
2. Reviews conversation thread and AI summary
3. Clicks patient info → Views patient profile
4. Selects response type from dropdown
5. (Optional) Adds text response
6. Submits review → Status updates immediately
7. Review result appears at bottom of thread

---

### 4.3 Patient Profile & Medical History ✅

**Feature Description**: Comprehensive patient information including medical history, notes, and conversation history.

**Key Capabilities**:
- **Patient Header**: Name, age, demographics
- **Medical History Section**: Current medications, allergies, conditions
- **Clinical Notes**: Provider-entered notes
- **Conversation History**: All past conversations/visits for this patient
- **Quick Navigation**: Tap conversation to view details

**UI Components**:
- `PatientProfileView`: Main profile interface
- `PatientHeaderView`: Patient identification
- `MedicalHistorySection`: Medical information display
- `NotesSection`: Clinical notes
- `ConversationHistorySection`: Past conversations list

**Data Displayed**:
- Patient name and age
- Current medications (list)
- Known allergies (list)
- Past medical conditions (list)
- Clinical notes (text)
- Conversation history (chronological list)

**User Flow**:
1. Provider taps patient name/info → Opens patient profile
2. Reviews medical history
3. Checks past conversations for context
4. Taps past conversation → Opens detail view
5. Returns to profile or navigates to current review

---

### 4.4 Patient Navigation (Hamburger Menu) ✅

**Feature Description**: Quick access to all patients and their conversation history.

**Key Capabilities**:
- **Patient List**: All patients from Supabase
- **Search Patients**: Filter patient list by name
- **Patient Selection**: Tap patient to view all their visits/conversations
- **Visit List**: Shows all encounters for selected patient
- **Undocked Menu**: Floating iOS 26-style side menu

**UI Components**:
- `SideMenuView`: Patient list menu
- `PatientChartView`: Patient's conversation list
- `PatientListItem`: Individual patient row

**User Flow**:
1. Provider taps hamburger menu (top left) → Menu slides in
2. Searches for patient name → Filters list
3. Taps patient → Navigates to patient chart
4. Sees all conversations/visits for that patient
5. Taps conversation → Opens detail view

---

### 4.5 Push Notifications ✅

**Feature Description**: Real-time alerts for new review requests and urgent cases.

**Key Capabilities**:
- **Remote Push Notifications**: APNs integration for new requests
- **Badge Updates**: App icon badge shows pending count
- **Foreground Notifications**: Display banners when app is open
- **Deep Linking**: Tap notification to open specific conversation
- **Device Token Registration**: Automatic registration with Supabase

**Implementation**:
- `ProviderPushNotificationManager`: Notification handling
- `AppDelegate`: APNs integration
- Supabase webhook: Triggers notifications
- Edge Function: Sends push notifications

**User Flow**:
1. New review request created → Supabase webhook fires
2. Edge Function sends push notification → Provider receives alert
3. Provider taps notification → App opens to conversation detail
4. Badge count updates → Shows number of pending reviews

---

### 4.6 Search & Filtering ✅

**Feature Description**: Efficient discovery of specific conversations and patients.

**Key Capabilities**:
- **Global Search**: Search across all conversations
- **Patient Search**: Filter patient list in side menu
- **Status Filtering**: Filter by review status
- **Real-time Results**: Instant filtering as user types

**Search Fields**:
- Conversation title
- Patient name
- User ID (fallback)

**Filter Options**:
- Pending reviews
- All reviews
- Flagged reviews

---

## 5. Technical Requirements

### 5.1 Platform & Technologies

**Platform**: iOS 26.0+  
**Language**: Swift 5.0+  
**Framework**: SwiftUI  
**Architecture**: MVVM with Combine

**Key Dependencies**:
- SwiftUI (native)
- Combine (reactive state management)
- UserNotifications (push notifications)
- CoreText (font loading)

### 5.2 Backend Integration

**API**: Supabase REST API  
**Authentication**: None (MVP - single provider)  
**Data Storage**: Supabase PostgreSQL  
**Push Notifications**: Apple Push Notification Service (APNs)

**Key Endpoints**:
- `GET /provider_review_requests` - Fetch review requests
- `GET /provider_review_requests?id=eq.{id}` - Fetch conversation details
- `PATCH /provider_review_requests?id=eq.{id}` - Update review status
- `POST /follow_up_messages` - Send provider messages
- `GET /providers` - Fetch provider info
- `POST /providers` - Register device token

### 5.3 Data Models

**Core Models**:
- `ProviderReviewRequestDetail`: Complete review request with conversation
- `ConversationMessage`: Individual message in conversation
- `ChildProfile`: Patient profile information
- `ProviderReviewResponse`: Provider's response to review

**Shared Models** (from patient app):
- `Message`: Message structure
- `Conversation`: Conversation metadata
- `Challenge`: Challenge/condition information

### 5.4 State Management

**Architecture**: MVVM with Combine  
**Store**: `ProviderConversationStore` (ObservableObject)

**State Properties**:
- `reviewRequests: [ProviderReviewRequestDetail]` - All review requests
- `conversationDetailsCache: [UUID: ProviderReviewRequestDetail]` - Cached details
- `isLoading: Bool` - Loading state
- `errorMessage: String?` - Error handling
- `pendingCount: Int` - Computed pending count
- `flaggedCount: Int` - Computed flagged count

**State Updates**:
- Auto-refresh every 60 seconds
- Manual refresh via pull-to-refresh
- Immediate updates after status changes

### 5.5 Design System

**Color Scheme**:
- Primary: Coral (`#FF6B6B`)
- Background: Adaptive beige (`#F2EDE0` light / system background dark)
- Secondary Background: Slightly lighter beige
- Text: Adaptive (black light / white dark)

**Typography**:
- Primary: RethinkSans-Regular
- Bold: RethinkSans-Bold
- Monospace: System monospace (for dates, ages, data points)
- Fallback: System rounded (if custom fonts unavailable)

**Components**:
- Custom button styles
- Status badges
- Message bubbles
- Patient info cards
- Search bars (white background)

### 5.6 Performance Requirements

**Response Times**:
- Initial app launch: < 2 seconds
- List load: < 500ms
- Detail view load: < 300ms (cached) / < 1s (network)
- Search/filter: < 100ms (instant)

**Optimization**:
- Conversation detail caching
- Lazy loading of messages
- Debounced search
- Efficient list rendering

---

## 6. User Flows

### 6.1 Primary Flow: Review & Respond

```
1. Provider opens app
   ↓
2. Sees list of pending reviews
   ↓
3. Taps conversation "Head Injury Check"
   ↓
4. Reviews conversation thread and AI summary
   ↓
5. Views patient info (age, history)
   ↓
6. Selects "Agree with Thoughts" from dropdown
   ↓
7. Types additional recommendation
   ↓
8. Submits review
   ↓
9. Sees review result at bottom
   ↓
10. Returns to list (conversation now marked "Responded")
```

### 6.2 Secondary Flow: Browse Patient History

```
1. Provider taps hamburger menu
   ↓
2. Searches for patient name
   ↓
3. Taps patient name
   ↓
4. Sees all 5 past conversations
   ↓
5. Taps conversation from 2 weeks ago
   ↓
6. Reviews previous AI recommendation
   ↓
7. Returns to current review with context
```

### 6.3 Urgent Flow: Push Notification

```
1. New urgent case created in Supabase
   ↓
2. Provider receives push notification
   ↓
3. Taps notification
   ↓
4. App opens directly to conversation detail
   ↓
5. Reviews urgent case immediately
   ↓
6. Escalates or responds
```

---

## 7. Design Requirements

### 7.1 Visual Design

**Style**: Clean, medical-grade interface  
**Aesthetic**: Matches patient app branding  
**Layout**: Mobile-first, single-column design

**Key Design Elements**:
- Rounded corners on cards and buttons
- Consistent spacing and padding
- Clear visual hierarchy
- Accessible color contrast
- Monospace fonts for data clarity

### 7.2 Interaction Design

**Haptic Feedback**: Enabled for key interactions
- Light: Menu toggle, button taps
- Medium: Form submissions
- Success: Successful actions
- Error: Failed actions

**Animations**:
- Smooth transitions between views
- Spring animations for menu
- Pull-to-refresh animation
- Loading indicators

**Accessibility**:
- VoiceOver support
- Dynamic type support
- High contrast mode support
- Semantic labels

### 7.3 Responsive Design

**Device Support**:
- iPhone (all sizes)
- iPad (universal app)
- Portrait and landscape orientations

**Adaptive Layouts**:
- Responsive to screen size
- Adaptive colors (light/dark mode)
- Flexible text sizing

---

## 8. Security & Compliance

### 8.1 Data Security

**Encryption**:
- TLS for all API communications
- Encrypted storage (UserDefaults for non-sensitive data)
- Secure API key storage (future: Keychain)

**Authentication** (Future):
- Provider authentication required
- Session management

### 8.2 HIPAA Compliance

**Current State** (MVP):
- No authentication (single provider)
- Local API key storage
- Direct Supabase access

**Future Requirements**:
- Provider authentication
- Encrypted data transmission
- Audit logging
- PHI encryption at rest

### 8.3 Privacy

**Data Collection**:
- Minimal data collection
- No analytics tracking (MVP)
- Device tokens for notifications only

**User Privacy**:
- No third-party SDKs
- Local-first architecture
- Optional data sharing

---

## 9. Future Enhancements

### 9.1 Phase 2 Features

**Authentication & Multi-Provider Support**:
- Provider login system
- Provider profiles and preferences

**Enhanced Analytics**:
- Response time trends
- Triage agreement rates
- Case type distribution
- Provider performance metrics
- Export capabilities

**Advanced Filtering**:
- Filter by triage outcome
- Filter by date range
- Filter by patient age
- Saved filter presets

**Communication Features**:
- Direct messaging with patients
- Group conversations
- File attachments (images, documents)
- Message templates

### 9.2 Phase 3 Features

**AI Integration**:
- Provider assistance tools
- Clinical decision support
- Drug interaction checking
- Medical reference lookup

**Workflow Automation**:
- Auto-assignment rules
- Priority queuing
- Escalation workflows
- Custom notifications

**Advanced Features**:
- Offline mode
- Multi-language support
- Custom themes
- Provider preferences

---

## 10. Success Criteria

### 10.1 MVP Success Metrics

**Functionality**:
- ✅ All core features implemented
- ✅ Data loads correctly from Supabase
- ✅ Provider can review and respond
- ✅ Push notifications working
- ✅ Fonts loading correctly

**Performance**:
- ✅ App launches in < 2 seconds
- ✅ List loads in < 500ms
- ✅ Detail view loads in < 1 second
- ✅ No crashes or critical bugs

**User Experience**:
- ✅ Intuitive navigation
- ✅ Consistent design language
- ✅ Responsive interactions
- ✅ Clear feedback for actions

### 10.2 Launch Readiness Checklist

**Technical**:
- [x] Core features implemented
- [x] Backend integration complete
- [x] Push notifications configured
- [x] Error handling implemented
- [x] Fonts bundled correctly
- [ ] Authentication implemented (future)
- [ ] Analytics integrated (future)
- [ ] Crash reporting (future)

**Quality Assurance**:
- [x] Manual testing complete
- [ ] Automated tests (future)
- [ ] Performance testing (future)
- [ ] Security audit (future)

**Documentation**:
- [x] PRD created
- [x] Architecture documented
- [x] Setup instructions provided
- [ ] User guide (future)
- [ ] API documentation (future)

---

## 11. Open Questions & Decisions

### 11.1 Authentication Strategy
**Question**: How should providers authenticate?  
**Options**:
- Email/password
- SSO (Single Sign-On)
- Magic link
- Biometric

**Decision**: TBD - Currently no authentication for MVP

### 11.2 Multi-Provider Support
**Question**: How should multiple providers share the same app?  
**Options**:
- Separate app instances per provider
- In-app provider switching
- Organization-based accounts

**Decision**: TBD - Currently single provider

### 11.3 Offline Mode
**Question**: Should the app work offline?  
**Considerations**:
- Cache conversations locally
- Queue responses for sync
- Show offline indicator

**Decision**: Future enhancement

---

## 12. Appendices

### 12.1 Key Files Reference

**App Structure**:
```
Clara Provider/
├── Clara_ProviderApp.swift      # App entry point
├── ContentView.swift             # Navigation container
├── Models/                       # Data models
├── Services/                     # API clients
├── Store/                        # State management
└── Views/                       # UI components
```

### 12.2 API Endpoints

**Supabase REST API**:
- `GET /rest/v1/provider_review_requests`
- `GET /rest/v1/provider_review_requests?id=eq.{id}`
- `PATCH /rest/v1/provider_review_requests?id=eq.{id}`
- `POST /rest/v1/follow_up_messages`
- `POST /rest/v1/providers`

### 12.3 Database Schema

**Tables Used**:
- `provider_review_requests`: Main review request data
- `follow_up_messages`: Provider messages to patients
- `providers`: Provider device tokens
- `patients`: Patient profiles (future)

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | Nov 2, 2025 | AI Assistant | Initial PRD creation |

---

## Approval

**Product Owner**: _______________  
**Engineering Lead**: _______________  
**Design Lead**: _______________  
**Date**: _______________

